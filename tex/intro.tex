%# -*- coding: utf-8-unix -*-
%%==================================================
%% chapter01.tex for SJTU Master Thesis
%%==================================================

%\bibliographystyle{sjtu2}%[此处用于每章都生产参考文献]
\chapter{绪论}
\label{chap:intro}

\section{研究背景和研究意义}\label{sec:intro_bg}
云计算在过去十年中备受欢迎，并被广泛应用到实际使用中，大量的云计算平台例如Amazon Web Services(AWS)\footnote{https://aws.amazon.com}、阿里云\footnote{https://www.aliyun.com}和Microsoft Azure\footnote{https://azure.microsoft.com}等已经提供了高可用、可伸缩、低成本的云服务，并且这些云服务已经被很多软件服务厂商用作他们软件研发的基础框架。软件服务厂商通过将自身的业务从传统的机器集群迁移到云服务中，使自己更加专注于业务能力的提升，降低自身诸如服务器、制冷设备等物理硬件的采购和维护成本。

在云计算浪潮中，虚拟化技术作为云计算技术的基石\cite{zhang2010cloud}，对提升整体的资源利用率提供了极大的帮助，其中以Xen\cite{barham2003xen}、KVM\cite{kivity2007kvm}和OpenStack\cite{sefraoui2012openstack}等虚拟机(Hypervisor)\cite{buyya2010cloud}方案作为代表。在最近几年中，容器化技术作为虚拟化技术实现的另一个选择，由于其轻量化、低成本和高效等特点\cite{soltesz2007container}，受到了越来越多云计算厂商的青睐，诸如AWS和阿里云等各大云计算厂商都推出了自己的容器云服务。容器虚拟化技术利用操作系统内核提供的cgroups和namespace等功能对进程进行封装隔离来实现虚拟化的目标。相比于传统的虚拟机技术中所必需的宿主端控制器和客户端操作系统，容器虚拟化技术利用内核的特性，以进程的方式直接运行于宿主端的操作系统内核，无需额外客户端操作系统。对比虚拟机常常需要数分钟才能完成一个虚拟化实例的启动，容器能在几秒之内完成一个虚拟化实例的启动，同时利用共享内存节省了加载客户端操作系统所消耗的资源。

Docker\footnote{https://www.docker.com}由于其提出的Docker镜像机制而成为目前最受欢迎的容器虚拟化平台\cite{merkel2014docker}，被广泛应用于各容器云服务中。通过Docker镜像，用户能通过简答的操作在不同的机器上获得一致的运行环境，极大的方便了软件应用和服务的开发和部署，降低了整体开发、部署过程中的成本。Docker镜像已经成为当前实质意义上的容器运行环境标准而被广泛接受和采用，现有的各大容器云提供商也都支持Docker镜像作为自身的标准容器镜像。

于此同时，随着互联网的爆发和普及，网络流量的变化越来越迅速和激烈。例如天猫的双十一活动和春运期间火爆的网上火车票销售，既显示出在当前的网络环境下网络流量的突发性变化已经成为常态，也揭示出流量的迅速变化对服务整体稳定性带来的考验。用户和云服务提供商之间就服务的响应时间、吞吐量和可用性等可量化标准达成一致，形成服务质量约束(Service Level Agreement， SLA)\cite{patel2009service}。利用云计算中“pay-as-you-go”的服务计费方式\cite{armbrust2010view}，越来越多的厂商用可以快速自动伸缩的容器云服务来代替传统的物理设备来作为自己的基础设施以应对动态变化的流量负载。特别是在负载急速增加的场景下，和传统的基于虚拟机的云服务相比，容器云可以在更短的时间内启动更多的虚拟化实例来应对激增的负载压力。此外，通过云服务厂商提供的实时监控工具和动态伸缩工具，用户可以指定相应的调节阈值来实现自动伸缩。以AWS为例，通过Auto Scaling这个工具，用户以CPU使用率作为伸缩策略的基准，当最近10分钟的CPU使用量持续超过80\%时，AWS将自动增加30\%的实例个数。此外，用户也可以根据监控系统的实时监控状态，基于以往的经验进行实例的添加或删除，从而达到服务伸缩的目的。除了使用云服务上提供的公有云服务之外，用户也能通过使用诸如Docker swarm、Kubernetes和Mesos等容器管理框架构建私有容器云，来满足自身的容器虚拟化需要，达到提高资源利用率和降低成本的目的。

通过对已有的各个公有容器云服务和容器管理框架进行调查，发现当前的服务模式和容器管理框架存在如下几点问题:
\begin{enumerate}
\item 通过主观阈值或者手工操作被动的应对负载变化。用户只能基于个人经验，通过设定阈值的方式来监控负载的实时状态，通过自动伸缩或者手动调节的方式来被动地响应异常变化的负载，针对负载的变化响应迟缓并存在一定的误差。由于扩容缩容操作本身仍然需要一定的耗时，因此基于负载现状进行容量调整必然导致调整的效果始终是落后于负载的实时变化。
\item 没有合理区分服务的可用性要求和负载需求。在目前所有的容器云服务和容器管理框架中，服务的副本数定义和服务运行需要的实例个数是等价的，这并不妥当。一方面，副本的定义在通常的意义上应该和服务自身的可用性要求有关。一个服务的副本数被用来表征一个服务为了满足自身的可用性规约而需要的最少实例数，这个数值在最开始的阶段就根据用户和服务提供商之间的SLA而确定了，并且在整个服务运行阶段很少发生变化\cite{beyer2016site}。另一方面，服务的实际实例数目则是和服务当前的实时负载状态有关，根据服务实际的负载状态来改变实例的数目，从而保证服务正常平稳的运行。通过增加或者减少实例的方法来减轻负载的变化给服务本身状态的影响，避免因为负载的变化而影响用户的使用体验。
\item 只有针对应用或者服务的负载均衡，过于依赖容器的轻量级特性，在服务负载变化场景下缺乏对合适的任务调度和管理机制，无法快速响应变化的负载。当前的容器云和容器管理框架都是根据实例的分布对应用或者服务进行负载的分配以达到负载均衡的目标，这就要求实例可以快速的完成部署并运行。虽然相比虚拟机，容器不需要加载客户端操作系统节省了大量的启动时间，然而在实际中，由于仍然需要下载和安装运行需要的相关依赖和配置环境，容器实例仍然需要一定的时间来完成整个启动过程后才能正常运行。根据Google在发表Borg的论文中提到的数据，Borg中容器运行所需要的相关依赖和环境配置时间占据了全部容器启动时间的80\%\cite{verma2015large}。在需要快速扩容的场景下，这就导致由于下载和安装依赖环境而造成额外的时间耗费，降低了响应的速度。
\end{enumerate}

我们将这一类根据实时的异常负载状态被动地做出调整的模式称为被动式管理模型。为了解决上述被动式模型在容器云环境下的问题，我们需要一个主动式的容器云资源管理模型，通过在实际负载到来之前提前感知即将到来的负载变化并据此对相应服务提前进行调整，而不必等实际的负载压力出现之后再依据设定的阈值对服务再做进行调整，最后通过加速服务调整过程的方式来提升容器云应对负载变化的能力。

\section{研究目的和内容}
本文将兼顾用户和容器云供应商的利益，着重解决在满足可用性指标的前提下，如何充分利用容器云中的资源以应对变化的负载。为此，本文提出了一个基于容器的主动式云资源管理模型，通过对负载进行预测来提前对服务进行调整，利用Docker镜像中的层级文件系统设计加速了服务的调整过程，从而使容器云能快速响应负载的变化，加强了容器云对负载变化的响应能力。在被动式模型中，服务总是在负载超过预定阈值之后再进行容量调整，导致直到负载稳定为止，服务的实际容量总是落后于负载的实际变化，而且服务调整的操作也没有任何优化。相比之下，在本文提出的主动式模型中服务可以提前感知负载的变化并提前做好容量调整，最后通过优化最终的任务实例调度选择来节省容器云中服务调整操作的耗时，从而更好地响应实际的负载变化，保障相应服务在负载变化的场景下仍然可以满足服务质量目标。该主动式模型在满足用户可用性指标的前提下，通过预测的方式提前感知负载的变化，在实际负载压力出现之前主动地调整服务容量；为了降低潜在的主动式负载感知错误导致额外的开销和违反SLA的风险，通过设定阈值的方式对异常的负载变化进行被动的响应，根据实际的负载变化对服务容量进行调整；通过整合云中的资源，优化任务实例的调度方式，提高对负载变化的响应能力。为了实现本文的相关研究目标，研究内容主要集中于以下三点：
\begin{enumerate}
\item 负载的监测和预测：本文将以内存、CPU时间、磁盘和网络带宽等资源的使用量和使用率作为负载的衡量，对系统进行实时的监测，从而获得系统的负载状态。利用合适的预测模型，对系统负载的历史数据进行分析处理从而得出将来一段时间内可能的资源使用量。
\item 生成相应的资源供给和管理方案：首先，建立云服务中的可用性模型，基于可用性分析和SLO确定副本数。随后，分别基于预测的负载状态和实际的负载状态生成相应的资源供给方案。在资源供给方案生成之后，根据系统当前的实际资源使用状态进行优化整合，通过服务伸缩的方式提供资源以满足相应的资源需求。
\item 动态变化负载的应对方案：基于实际负载状态和容器云中的当前状态，对容器云中所有实例的分布进行优化和调整，实现服务的动态伸缩(scale-out/scale-in)，在满足SLO中可用性相关需求的基础上，减少实例调度过程的耗时以提高其服务质量，提高资源利用率以降低云服务供应商的成本，最终实现容器云中整体的负载均衡，达到及时响应负载变化的目的。
\end{enumerate}

\section{论文结构}
本文一共六章，其中本章介绍了本文的研究背景，分析了研究意义，然后又介绍了研究目的和研究内容。其余章节组织如下：第\ref{chap:art_of_state}章介绍了相关技术和相关领域的国内外研究现状；第\ref{chap:sys_design}章从系统的整体架构开始，对系统的详细设计进行了介绍和说明；第\ref{chap:sys_impl}章详细介绍了关于本文提出的模型，以Docker swarm作为容器云的实现，介绍了各模块的具体实现，并对整体实现思路进行了分析和讨论；第\ref{chap:sys_eval}章介绍了本文为了验证方案正确性和有效性所进行的实验，对实验结果进行说明并对此进行深入的探讨；第\ref{chap:summary}章对本文的主要工作成果进行总结，并对未来工作进行了展望。